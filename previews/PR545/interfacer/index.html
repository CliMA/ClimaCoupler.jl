<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Interfacer · ClimaCoupler.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaCoupler.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCoupler.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Sea Breeze</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/sea_breeze/atmos_rhs/">Atmospheric Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/land_rhs/">Land Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/ocean_rhs/">Ocean Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/run/">Coupled Sea Breeze</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">AMIP</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/amip/coupler_driver_modular/">AMIP Driver</a></li></ul></li></ul></li><li><span class="tocitem">Coupler Interface</span><ul><li><a class="tocitem" href="../regridder/">Regridder</a></li><li><a class="tocitem" href="../conservation/">Conservation Checks</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li><li><a class="tocitem" href="../bcreader/">BCReader</a></li><li><a class="tocitem" href="../testhelper/">TestHelper</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li></ul></li><li><span class="tocitem">Performance</span><ul><li><a class="tocitem" href="../performance/">Performance Analysis Tools</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Interfacer</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Interfacer</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaCoupler.jl/blob/main/docs/src/interfacer.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Interfacer"><a class="docs-heading-anchor" href="#Interfacer">Interfacer</a><a id="Interfacer-1"></a><a class="docs-heading-anchor-permalink" href="#Interfacer" title="Permalink"></a></h1><p>This module contains functions for defining the interface for coupling component models, as well as stub objects that contain prescribed fields.</p><h2 id="Coupled-Simulation"><a class="docs-heading-anchor" href="#Coupled-Simulation">Coupled Simulation</a><a id="Coupled-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Coupled-Simulation" title="Permalink"></a></h2><ul><li><code>CoupledSimulation</code> (<code>cs</code>) stores info for ESM run. We require that each <code>cs</code> contains four (<code>atmos_sim</code>, <code>land_sim</code>, <code>ocean_sim</code> and <code>ice_sim</code>) components. While this requirement will not be eventually needed, for the time being, if a simulation surface type is not needed for a given run, it should be initialized with <code>SurfaceStub</code> with a zero <code>area_fracion</code>. The <code>atmos_sim</code> should always be specified.</li></ul><h2 id="Component-model-simulations"><a class="docs-heading-anchor" href="#Component-model-simulations">Component model simulations</a><a id="Component-model-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Component-model-simulations" title="Permalink"></a></h2><ul><li>all Simulations that are not the <code>CoupledSimulation</code> fall under <code>ComponentModelSimulation</code></li><li>the current version requires that there is:<ul><li>one <code>AtmosModelSimulation</code></li><li>one or more <code>SurfaceModelSimulation</code>s, which require the following adapter functions:</li></ul></li></ul><h2 id="AtmosModelSimulation-requirements"><a class="docs-heading-anchor" href="#AtmosModelSimulation-requirements"><code>AtmosModelSimulation</code> requirements</a><a id="AtmosModelSimulation-requirements-1"></a><a class="docs-heading-anchor-permalink" href="#AtmosModelSimulation-requirements" title="Permalink"></a></h2><h2 id="SurfaceModelSimulation-requirements"><a class="docs-heading-anchor" href="#SurfaceModelSimulation-requirements"><code>SurfaceModelSimulation</code> requirements</a><a id="SurfaceModelSimulation-requirements-1"></a><a class="docs-heading-anchor-permalink" href="#SurfaceModelSimulation-requirements" title="Permalink"></a></h2><h3 id="&quot;Getter&quot;-functions-(get_field)"><a class="docs-heading-anchor" href="#&quot;Getter&quot;-functions-(get_field)">&quot;Getter&quot; functions (<code>get_field</code>)</a><a id="&quot;Getter&quot;-functions-(get_field)-1"></a><a class="docs-heading-anchor-permalink" href="#&quot;Getter&quot;-functions-(get_field)" title="Permalink"></a></h3><ul><li>Each <code>SurfaceModelSimulation</code> is required to implement the following &quot;getter&quot;</li></ul><p>functions, which retrieve a value from the model and provide it to the coupler. This requires accessing the model&#39;s internal structure, so they should be implemented in an <code>init</code> function in the model&#39;s own repository to abstract model specifics away from the coupler.</p><pre><code class="nohighlight hljs">    get_field(sim::SurfaceModelSimulation, ::Val{:surface_temperature}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:surface_humidity}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:roughness_momentum}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:roughness_buoyancy}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:beta}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:albedo}) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:area_fraction}, field::Fields.Field) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:air_density}, field::Fields.Field) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:energy}, field::Fields.Field) = ...
    get_field(sim::SurfaceModelSimulation, ::Val{:water}, field::Fields.Field) = ...
    ```
    - these adapter functions, to be defined in the component models&#39; init files (preferably in their own repositories), allow the coupler to operate without having to assume particular data structures of the underlying component models. This allows easy swapping of model components, as well as a stable source code with coupler-specific unit tests.
    - note that these functions are currently defined in component models&#39; init
    files in `experiments/AMIP`, but these will be moved to the components&#39;
    own repositories eventually.

### Update functions (`update_field!`)
- Each `SurfaceModelSimulation` is also required to implement the following
update methods. These should overwrite the model&#39;s value for a particular
quantity with the value stored in `field`, again accessing the internals of
the particular model:
    ```
    update_field!(sim::SurfaceModelSimulation, ::Val{:turbulent_energy_flux}, field) = ...
    update_field!(sim::SurfaceModelSimulation, ::Val{:turbulent_moisture_flux}, field) = ...
    update_field!(sim::SurfaceModelSimulation, ::Val{:radiative_energy_flux}, field) = ...
    update_field!(sim::SurfaceModelSimulation, ::Val{:liquid_precipitation}, field) = ...
    update_field!(sim::SurfaceModelSimulation, ::Val{:snow_precipitation}, field)
    update_field!(sim::SurfaceModelSimulation, ::Val{:air_density}, field)
    ```

### Timestepping functions
- Each component model is required to provide methods for the following
functions so that the coupler is able to timestep each component model:
    ```
    step!(sim::SurfaceModelSimulation, t) = ...
    reinit!(sim::SurfaceModelSimulation) = ...
    ```

## Prescribed conditions
- `SurfaceStub` is a `SurfaceModelSimulation`, but it only contains required data in `&lt;surface_stub&gt;.cache`, e.g., for the calculation of surface fluxes through a prescribed surface state.  The above adapter functions are already predefined for `SurfaceStub`, with the cache variables specified as:</code></pre><p>get<em>field(sim::SurfaceStub, ::Val{:area</em>fraction}) = sim.cache.area<em>fraction get</em>field(sim::SurfaceStub, ::Val{:surface<em>temperature}) = sim.cache.T</em>sfc get<em>field(sim::SurfaceStub, ::Val{:albedo}) = sim.cache.α get</em>field(sim::SurfaceStub, ::Val{:roughness<em>momentum}) = sim.cache.z0m get</em>field(sim::SurfaceStub, ::Val{:roughness<em>buoyancy}) = sim.cache.z0b get</em>field(sim::SurfaceStub, ::Val{:beta}) = sim.cache.beta</p><pre><code class="nohighlight hljs">with the corresponding `update_field!` functions</code></pre><p>function update<em>field!(sim::SurfaceStub, ::Val{:area</em>fraction}, field::Fields.Field)     sim.cache.area<em>fraction .= field end function update</em>field!(sim::SurfaceStub, ::Val{:surface<em>temperature}, field::Fields.Field)     sim.cache.T</em>sfc .= field end</p><pre><code class="nohighlight hljs">
## Interfacer API
</code></pre><p>@docs     ClimaCoupler.Interfacer.ComponentModelSimulation     ClimaCoupler.Interfacer.AtmosModelSimulation     ClimaCoupler.Interfacer.SurfaceModelSimulation     ClimaCoupler.Interfacer.SurfaceStub     ClimaCoupler.Interfacer.name     ClimaCoupler.Interfacer.get<em>field     ClimaCoupler.Interfacer.update</em>field! ```</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 21 December 2023 19:58">Thursday 21 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
