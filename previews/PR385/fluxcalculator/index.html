<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FluxCalculator · ClimaCoupler.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaCoupler.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCoupler.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Sea Breeze</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/sea_breeze/atmos_rhs/">Atmospheric Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/land_rhs/">Land Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/ocean_rhs/">Ocean Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/run/">Coupled Sea Breeze</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">AMIP</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/amip/coupler_driver_modular/">AMIP Driver</a></li></ul></li></ul></li><li><span class="tocitem">Coupler Interface</span><ul><li><a class="tocitem" href="../couplerstate/">Coupler State</a></li><li><a class="tocitem" href="../timestepping/">Coupled Simulations &amp; Timestepping</a></li><li><a class="tocitem" href="../regridder/">Regridder</a></li><li><a class="tocitem" href="../conservation/">Conservation Checks</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li><li><a class="tocitem" href="../bcreader/">BCReader</a></li><li><a class="tocitem" href="../testhelper/">TestHelper</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li></ul></li><li><span class="tocitem">Performance</span><ul><li><a class="tocitem" href="../performance/">Performance Analysis Tools</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>FluxCalculator</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FluxCalculator</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaCoupler.jl/blob/main/docs/src/fluxcalculator.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="FluxCalculator"><a class="docs-heading-anchor" href="#FluxCalculator">FluxCalculator</a><a id="FluxCalculator-1"></a><a class="docs-heading-anchor-permalink" href="#FluxCalculator" title="Permalink"></a></h1><p>This modules contains abstract types and functions to calculate surface fluxes in the coupler, or to call flux calculating functions from the component models.</p><p>Fluxes over a heterogeneous surface (e.g., from a gridpoint where atmospheric cell is overlying both land and ocean) can be handled in two different ways:</p><ol><li><strong>Combined fluxes</strong> (called with <code>CombinedStateFluxes()</code>)</li></ol><ul><li>these are calculated by averaging the surface properties for each gridpoint (e.g., land and ocean temperatures, albedos and roughness lengths are averaged, based on their respective area fractions), so the flux is calculated only once per gridpoint of the grid where we calculate fluxes. This is computationally faster, but it makes the fluxes on surface boundaries more diffuse. Currently, we use this method for calculating radiative fluxes in the atmosphere, and turbulent fluxes in the coupler (on the atmospheric grid). The fluxes are calculated in the atmospheric (host) model&#39;s cache, which can be setup to avoid allocating coupler fields.</li></ul><ol><li><strong>Partitioned fluxes</strong> (called with <code>PartitionedStateFluxes()</code>)</li></ol><ul><li>these are calculated separately for each surface type. It is then the fluxes (rather than the surface states) that are combined and passed to the atmospheric model as a boundary condition. This method ensures that each surface model receives fluxes that correspond to its state properties, resulting in a more accurate model evolution. However, it is more computationally expensive, and requires more communication between the component models.</li></ul><h2 id="FluxCalculator-API"><a class="docs-heading-anchor" href="#FluxCalculator-API">FluxCalculator API</a><a id="FluxCalculator-API-1"></a><a class="docs-heading-anchor-permalink" href="#FluxCalculator-API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.FluxCalculator.TurbulentFluxPartition" href="#ClimaCoupler.FluxCalculator.TurbulentFluxPartition"><code>ClimaCoupler.FluxCalculator.TurbulentFluxPartition</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">TurbulentFluxPartition</code></pre><p>Abstract type for flags that denote where and how to calculate tubulent fluxes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/4d201462201a8b4b09d26aedacfc87cc206c00ab/src/FluxCalculator.jl#L28-L32">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.FluxCalculator.PartitionedStateFluxes" href="#ClimaCoupler.FluxCalculator.PartitionedStateFluxes"><code>ClimaCoupler.FluxCalculator.PartitionedStateFluxes</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">PartitionedStateFluxes &lt;: TurbulentFluxPartition</code></pre><p>A flag indicating that the turbulent fluxes should be partitioned and calculated over each surface model and then combined. This is calculated on the coupler grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/4d201462201a8b4b09d26aedacfc87cc206c00ab/src/FluxCalculator.jl#L35-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.FluxCalculator.CombinedStateFluxes" href="#ClimaCoupler.FluxCalculator.CombinedStateFluxes"><code>ClimaCoupler.FluxCalculator.CombinedStateFluxes</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CombinedStateFluxes &lt;: TurbulentFluxPartition</code></pre><p>A flag indicating that the turbulent fluxes (e.g. sensible and latent heat fluxes, drag and moisture fluxes) are to be  calculated on the Atmos grid, and saved in Atmos cache.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/4d201462201a8b4b09d26aedacfc87cc206c00ab/src/FluxCalculator.jl#L43-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.FluxCalculator.combined_turbulent_fluxes!" href="#ClimaCoupler.FluxCalculator.combined_turbulent_fluxes!"><code>ClimaCoupler.FluxCalculator.combined_turbulent_fluxes!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">combined_turbulent_fluxes!(model_sims, csf, turbulent_fluxes::TurbulentFluxPartition)</code></pre><p>Calls the method(s) which calculate turbulent surface fluxes from combined surface states in coupler fields, <code>csf</code>.</p><p><strong>Arguments</strong></p><ul><li><code>model_sims</code>: [NamedTuple] containing <code>ComponentModelSimulation</code>s.</li><li><code>csf</code>: [NamedTuple] containing coupler fields.</li><li><code>turbulent_fluxes</code>: [TurbulentFluxPartition] denotes a flag for turbulent flux calculation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/4d201462201a8b4b09d26aedacfc87cc206c00ab/src/FluxCalculator.jl#L51-L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.FluxCalculator.atmos_turbulent_fluxes!" href="#ClimaCoupler.FluxCalculator.atmos_turbulent_fluxes!"><code>ClimaCoupler.FluxCalculator.atmos_turbulent_fluxes!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">atmos_turbulent_fluxes!(sim::Interfacer.ComponentModelSimulation, csf)</code></pre><p>A function to calculate turbulent surface fluxes using the combined surface states. It is required that a method is defined for the given <code>sim</code> and that the fluxes are saved in that sim&#39;s cache. <code>csf</code> refers to the coupler fields.</p><p><strong>Arguments</strong></p><ul><li><code>sim</code>: [Interfacer.ComponentModelSimulation] object containing the component model simulation.</li><li><code>csf</code>: [NamedTuple] containing coupler fields.</li></ul><p><strong>Example:</strong></p><pre><code class="nohighlight hljs">function atmos_turbulent_fluxes!(atmos_sim::ClimaAtmosSimulation, csf)
    atmos_sim.cache.flux .= atmos_sim.c .* (csf.T_S .- atmos_sim.temperature)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/4d201462201a8b4b09d26aedacfc87cc206c00ab/src/FluxCalculator.jl#L70-L89">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 11 August 2023 20:55">Friday 11 August 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
