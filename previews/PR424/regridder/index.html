<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Regridder · ClimaCoupler.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaCoupler.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCoupler.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Sea Breeze</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/sea_breeze/atmos_rhs/">Atmospheric Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/land_rhs/">Land Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/ocean_rhs/">Ocean Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/run/">Coupled Sea Breeze</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">AMIP</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/amip/coupler_driver_modular/">AMIP Driver</a></li></ul></li></ul></li><li><span class="tocitem">Coupler Interface</span><ul><li><a class="tocitem" href="../couplerstate/">Coupler State</a></li><li><a class="tocitem" href="../timestepping/">Coupled Simulations &amp; Timestepping</a></li><li class="is-active"><a class="tocitem" href>Regridder</a><ul class="internal"><li><a class="tocitem" href="#Regridder-API"><span>Regridder API</span></a></li><li><a class="tocitem" href="#Regridder-Internal-Functions"><span>Regridder Internal Functions</span></a></li></ul></li><li><a class="tocitem" href="../conservation/">Conservation Checks</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li><li><a class="tocitem" href="../bcreader/">BCReader</a></li><li><a class="tocitem" href="../testhelper/">TestHelper</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li></ul></li><li><span class="tocitem">Performance</span><ul><li><a class="tocitem" href="../performance/">Performance Analysis Tools</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Coupler Interface</a></li><li class="is-active"><a href>Regridder</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Regridder</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaCoupler.jl/blob/main/docs/src/regridder.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Regridder"><a class="docs-heading-anchor" href="#Regridder">Regridder</a><a id="Regridder-1"></a><a class="docs-heading-anchor-permalink" href="#Regridder" title="Permalink"></a></h1><p>This module contains functions to regrid information between spaces. Many of the functions used in this module call TempestRemap functions via ClimaCoreTempestRemap wrappers.</p><p>Information about the TempestRemap library can be found <a href="https://github.com/ClimateGlobalChange/tempestremap">here</a>. Multiple remapping approaches from TempestRemap have been tested with our implementation, and information about them is located <a href="https://github.com/CliMA/ClimaCoupler.jl/wiki/ClimaCoupler-Lessons-Learned">here</a>.</p><h2 id="Regridder-API"><a class="docs-heading-anchor" href="#Regridder-API">Regridder API</a><a id="Regridder-API-1"></a><a class="docs-heading-anchor-permalink" href="#Regridder-API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.write_to_hdf5" href="#ClimaCoupler.Regridder.write_to_hdf5"><code>ClimaCoupler.Regridder.write_to_hdf5</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">write_to_hdf5(REGRID_DIR, hd_outfile_root, time, field, varname, comms_ctx)</code></pre><p>Function to save individual HDF5 files after remapping. If a CommsContext other than <code>SingletonCommsContext</code> is used for <code>comms_ctx</code>, the HDF5 output is readable by multiple MPI processes.</p><p><strong>Arguments</strong></p><ul><li><code>REGRID_DIR</code>: [String] directory to save output files in.</li><li><code>hd_outfile_root</code>: [String] root of the output file name.</li><li><code>time</code>: [Dates.DateTime] the timestamp of the data being written.</li><li><code>field</code>: [Fields.Field] object to be written.</li><li><code>varname</code>: [String] variable name of data.</li><li><code>comms_ctx</code>: [ClimaComms.AbstractCommsContext] context used for this operation.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L199-L213">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.read_from_hdf5" href="#ClimaCoupler.Regridder.read_from_hdf5"><code>ClimaCoupler.Regridder.read_from_hdf5</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_from_hdf5(REGIRD_DIR, hd_outfile_root, time, varname, comms_ctx)</code></pre><p>Read in a variable <code>varname</code> from an HDF5 file. If a CommsContext other than <code>SingletonCommsContext</code> is used for <code>comms_ctx</code>, the input HDF5 file must be readable by multiple MPI processes.</p><p><strong>Arguments</strong></p><ul><li><code>REGRID_DIR</code>: [String] directory to save output files in.</li><li><code>hd_outfile_root</code>: [String] root of the output file name.</li><li><code>time</code>: [Dates.DateTime] the timestamp of the data being written.</li><li><code>varname</code>: [String] variable name of data.</li><li><code>comms_ctx</code>: [ClimaComms.AbstractCommsContext] context used for this operation.</li></ul><p><strong>Returns</strong></p><ul><li>Field or FieldVector</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L223-L239">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.dummmy_remap!" href="#ClimaCoupler.Regridder.dummmy_remap!"><code>ClimaCoupler.Regridder.dummmy_remap!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">dummmy_remap!(target, source)</code></pre><p>Simple stand-in function for remapping. For AMIP we don&#39;t need regridding of surface model fields. When we do, we re-introduce the ClimaCoreTempestRemap remapping functions.</p><p><strong>Arguments</strong></p><ul><li><code>target</code>: [Fields.Field] destination of remapping.</li><li><code>source</code>: [Fields.Field] source of remapping.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L248-L258">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.remap_field_cgll_to_rll" href="#ClimaCoupler.Regridder.remap_field_cgll_to_rll"><code>ClimaCoupler.Regridder.remap_field_cgll_to_rll</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">remap_field_cgll_to_rll(
    name,
    field::Fields.Field,
    remap_tmpdir,
    datafile_rll;
    nlat = 90,
    nlon = 180
)</code></pre><p>Remap an individual FT-valued Field from model (CGLL) nodes to a lat-lon (RLL) grid using TempestRemap.</p><p><strong>Arguments</strong></p><ul><li><code>name</code>: [Symbol] variable name.</li><li><code>field</code>: [Fields.Field] data to be remapped.</li><li><code>remap_tmpdir</code>: [String] directory used for remapping.</li><li><code>datafile_rll</code>: [String] filename of remapped data output.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L285-L303">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.land_fraction" href="#ClimaCoupler.Regridder.land_fraction"><code>ClimaCoupler.Regridder.land_fraction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function land_fraction(
    FT,
    REGRID_DIR,
    comms_ctx::ClimaComms.AbstractCommsContext,
    infile,
    varname,
    boundary_space;
    outfile_root = &quot;land_sea_cgll&quot;,
    mono = false,
    threshold = 0.7,
)</code></pre><p>Initialize a fraction for land/sea classification of grid squares over the space. With <code>mono</code> = <code>true</code>, remappings are monotone and conservative, (slower). With <code>mono</code> = <code>false</code>, values outside of <code>threshold</code> are cutoff (faster).</p><p>See https://github.com/CliMA/ClimaCoupler.jl/wiki/ClimaCoupler-Lessons-Learned     for a detailed comparison of remapping approaches.</p><p><strong>Arguments</strong></p><ul><li><code>FT</code>: [DataType] Float type</li><li><code>REGRID_DIR</code>: [String] directory to save output files in.</li><li><code>comms_ctx</code>: [ClimaComms.AbstractCommsContext] context used for this operation.</li><li><code>infile</code>: [String] filename containing input data.</li><li><code>varname</code>: [Symbol] variable name.</li><li><code>boundary_space</code>: [Spaces.AbstractSpace] over which we are mapping data.</li><li><code>outfile_root</code>: [String] root for output file name.</li><li><code>mono</code>: [Bool] flag for monotone remapping.</li><li><code>threshold</code>: [FT] cutoff value for <code>binary_mask</code> when non-monotone remapping.</li></ul><p><strong>Returns</strong></p><ul><li>Fields.Field</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L333-L366">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.update_surface_fractions!" href="#ClimaCoupler.Regridder.update_surface_fractions!"><code>ClimaCoupler.Regridder.update_surface_fractions!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_surface_fractions!(cs::CoupledSimulation)</code></pre><p>Updates dynamically changing area fractions. Maintains the invariant that the sum of area fractions is 1 at all points.</p><p><strong>Arguments</strong></p><ul><li><code>cs</code>: [CoupledSimulation] containing area fraction information.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L397-L405">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.combine_surfaces!" href="#ClimaCoupler.Regridder.combine_surfaces!"><code>ClimaCoupler.Regridder.combine_surfaces!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">combine_surfaces!(combined_field::Fields.Field, sims, field_name::Val)</code></pre><p>Sums the fields, specified by <code>field_name</code>, weighted by the respective area fractions of all surface simulations. THe result is saved in <code>combined_field</code>.</p><p><strong>Arguments</strong></p><ul><li><code>combined_field</code>: [Fields.Field] output object containing weighted values.</li><li><code>sims</code>: [NamedTuple] containing simulations .</li><li><code>field_name</code>: [Val] containing the name Symbol of the field t be extracted by the <code>get_field</code> functions.</li></ul><p><strong>Example</strong></p><ul><li><code>combine_surfaces!(zeros(boundary_space), cs.model_sims, Val(:surface_temperature))</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L441-L454">source</a></section></article><h2 id="Regridder-Internal-Functions"><a class="docs-heading-anchor" href="#Regridder-Internal-Functions">Regridder Internal Functions</a><a id="Regridder-Internal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Regridder-Internal-Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.reshape_cgll_sparse_to_field!" href="#ClimaCoupler.Regridder.reshape_cgll_sparse_to_field!"><code>ClimaCoupler.Regridder.reshape_cgll_sparse_to_field!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reshape_cgll_sparse_to_field!(field::Fields.Field, in_array::Array, R)</code></pre><p>Reshapes a sparse vector array <code>in_array</code> (CGLL, raw output of the TempestRemap), and uses its data to populate the input Field object <code>field</code>. Redundant nodes are populated using <code>dss</code> operations.</p><p><strong>Arguments</strong></p><ul><li><code>field</code>: [Fields.Field] object populated with the input array.</li><li><code>in_array</code>: [Array] input used to fill <code>field</code>.</li><li><code>R</code>: [NamedTuple] containing <code>target_idxs</code> and <code>row_indices</code> used for indexing.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L35-L46">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.hdwrite_regridfile_rll_to_cgll" href="#ClimaCoupler.Regridder.hdwrite_regridfile_rll_to_cgll"><code>ClimaCoupler.Regridder.hdwrite_regridfile_rll_to_cgll</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">hdwrite_regridfile_rll_to_cgll(
    FT,
    REGRID_DIR,
    datafile_rll,
    varname,
    space;
    hd_outfile_root = &quot;data_cgll&quot;,
    mono = false,
)</code></pre><p>Reads and regrids data of the <code>varname</code> variable from an input NetCDF file and saves it as another NetCDF file using Tempest Remap. The input NetCDF fileneeds to be <code>Exodus</code> formatted, and can contain time-dependent data. The output NetCDF file is then read back, the output arrays converted into Fields and saved as HDF5 files (one per time slice). This function should be called by the root process. The saved regridded HDF5 output is readable by multiple MPI processes.</p><p><strong>Arguments</strong></p><ul><li><code>FT</code>: [DataType] Float type.</li><li><code>REGRID_DIR</code>: [String] directory to save output files in.</li><li><code>datafile_rll</code>: [String] filename of RLL dataset to be mapped to CGLL.</li><li><code>varname</code>: [String] the name of the variable to be remapped.</li><li><code>space</code>: [Spaces.AbstractSpace] the space to which we are mapping.</li><li><code>hd_outfile_root</code>: [String] root of the output file name.</li><li><code>mono</code>: [Bool] flag to specify monotone remapping.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L67-L94">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.write_datafile_cc" href="#ClimaCoupler.Regridder.write_datafile_cc"><code>ClimaCoupler.Regridder.write_datafile_cc</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">write_datafile_cc(datafile_cc, field, name)</code></pre><p>Write the data stored in <code>field</code> to an NCDataset file <code>datafile_cc</code>.</p><p><strong>Arguments</strong></p><ul><li><code>datafile_cc</code>: [String] filename of output file.</li><li><code>field</code>: [Fields.Field] to be written to file.</li><li><code>name</code>: [Symbol] variable name.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L263-L272">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="ClimaCoupler.Regridder.binary_mask" href="#ClimaCoupler.Regridder.binary_mask"><code>ClimaCoupler.Regridder.binary_mask</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">binary_mask(var::FT; threshold = 0.5)</code></pre><p>Converts a number <code>var</code> to 1, if <code>var</code> is greater or equal than a given <code>threshold</code> value, or 0 otherwise, keeping the same type.</p><p><strong>Arguments</strong></p><ul><li><code>var</code>: [FT] value to be converted.</li><li><code>threshold</code>: [Float] cutoff value for conversions.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaCoupler.jl/blob/2c45c688e77369a7079b48f56b8079b81b9ba2fa/src/Regridder.jl#L430-L438">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../timestepping/">« Coupled Simulations &amp; Timestepping</a><a class="docs-footer-nextpage" href="../conservation/">Conservation Checks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 18 September 2023 21:29">Monday 18 September 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
