<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging Tips · ClimaCoupler.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="ClimaCoupler.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ClimaCoupler.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../running/">Running a simulation</a></li><li><a class="tocitem" href="../coupledsimulation/">The CoupledSimulation object</a></li><li><a class="tocitem" href="../models/">Available component models</a></li><li><a class="tocitem" href="../simtypes/">Available simulation types</a></li><li><span class="tocitem">Coupler interface</span><ul><li><a class="tocitem" href="../interfacer/">Interfacer</a></li><li><a class="tocitem" href="../input/">Input</a></li><li><a class="tocitem" href="../simcoordinator/">SimCoordinator</a></li><li><a class="tocitem" href="../timemanager/">TimeManager</a></li><li><a class="tocitem" href="../fieldexchanger/">FieldExchanger</a></li><li><a class="tocitem" href="../fluxcalculator/">FluxCalculator</a></li><li><a class="tocitem" href="../checkpointer/">Checkpointer</a></li><li><a class="tocitem" href="../conservation/">ConservationChecker</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li></ul></li><li><span class="tocitem">Simulation output</span><ul><li><a class="tocitem" href="../simoutput/">SimOutput</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../leaderboard/">Leaderboard</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-8-1" type="checkbox"/><label class="tocitem" for="menuitem-8-1"><span class="docs-label">AMIP</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/amip/run_amip/">AMIP Driver</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2" type="checkbox"/><label class="tocitem" for="menuitem-8-2"><span class="docs-label">Sea Breeze</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../generated/sea_breeze/atmos_rhs/">Atmospheric Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/land_rhs/">Land Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/ocean_rhs/">Ocean Model</a></li><li><a class="tocitem" href="../generated/sea_breeze/run/">Coupled Sea Breeze</a></li></ul></li></ul></li><li><a class="tocitem" href="../calibrationtools/">Parameter calibration</a></li><li><span class="tocitem">Developer docs</span><ul><li><a class="tocitem" href="../contributing/">Contributing</a></li><li class="is-active"><a class="tocitem" href>Debugging Tips</a><ul class="internal"><li><a class="tocitem" href="#Package-incompatibilities"><span>Package incompatibilities</span></a></li><li><a class="tocitem" href="#Numerical-instabilities"><span>Numerical instabilities</span></a></li><li><a class="tocitem" href="#Software-errors"><span>Software errors</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer docs</a></li><li class="is-active"><a href>Debugging Tips</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging Tips</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaCoupler.jl/blob/main/docs/src/debugging.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging-Tips"><a class="docs-heading-anchor" href="#Debugging-Tips">Debugging Tips</a><a id="Debugging-Tips-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-Tips" title="Permalink"></a></h1><p>Coupled simulations can fail or produce incorrect results for several broad reasons:</p><ul><li><strong>Package incompatibilities or versioning errors</strong>: A dependency conflict prevents the simulation from starting at all or causes unexpected behavior.</li><li><strong>Numerical instabilities</strong>: The simulation starts but crashes during the run due to unphysical values propagating through the component models.</li><li><strong>Software errors</strong>: A bug in the coupling code causes incorrect dispatch, wrong field updates, or silent failures.</li></ul><p>Here we suggest some approaches for debugging each of these cases.</p><h2 id="Package-incompatibilities"><a class="docs-heading-anchor" href="#Package-incompatibilities">Package incompatibilities</a><a id="Package-incompatibilities-1"></a><a class="docs-heading-anchor-permalink" href="#Package-incompatibilities" title="Permalink"></a></h2><p>Julia resolves package versions at environment instantiation time. Because ClimaCoupler.jl depends on a large number of packages from the CliMA ecosystem and beyond, it can be difficult to keep all compat entries simultaneously satisfied.</p><p><strong>Tips for maintaining compatibility:</strong></p><ul><li>Keep <code>[compat]</code> entries in <code>Project.toml</code> files as broad as possible in ClimaCoupler.jl and upstream packages. Only restrict a version range when a specific breaking change, bug, or API incompatibility requires it. Overly narrow compat entries are a common source of resolution failures across the ecosystem.</li></ul><p><strong>Debugging a broken environment:</strong></p><p>If Julia cannot resolve or load your environment, try the following steps in order:</p><pre><code class="language-julia hljs"># 1. Make sure the environment is fully instantiated
import Pkg
Pkg.instantiate()

# 2. Try resolving to enforce version constraints from scratch
Pkg.resolve()

# 3. Update all packages to the latest compatible versions
Pkg.update()</code></pre><p>If the above steps don&#39;t help, the issue is often caused by one specific package being pinned to an incompatible version. A somewhat-reliable workaround is to remove the offending package and re-add it so the resolver can pick a fresh compatible version:</p><pre><code class="language-julia hljs">Pkg.rm(&quot;OffendingPackage&quot;)
Pkg.add(&quot;OffendingPackage&quot;)</code></pre><p>Sometimes two packages constrain each other in conflicting ways; in that case, remove both at once before re-adding them. You can also run <code>Pkg.status()</code> to inspect version pins and <code>Pkg.resolve()</code> to see the full error message from the resolver.</p><h2 id="Numerical-instabilities"><a class="docs-heading-anchor" href="#Numerical-instabilities">Numerical instabilities</a><a id="Numerical-instabilities-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-instabilities" title="Permalink"></a></h2><p>A common symptom is a simulation that starts successfully but crashes at a particular timestep with a NaN or domain error. A common debugging workflow for this is:</p><ol><li>Run the simulation once to identify the failing timestep.</li><li>Start a new simulation interactively and advance it via <code>step!</code> until just before the crash, then inspect coupler fields and component model states.</li></ol><pre><code class="language-julia hljs"># Run from the top-level ClimaCoupler.jl/ directory
include(&quot;experiments/ClimaEarth/code_loading.jl&quot;)

cs = CoupledSimulation()

# Advance to one step before the known failure
for i in 1:failing_step - 1
    step!(cs)
end

# Now inspect coupler fields for unphysical values
@info extrema(cs.fields.T_sfc)
@info extrema(cs.fields.F_turb_moisture)
@info extrema(cs.fields.F_lh)</code></pre><p>Look for: negative temperatures, extremely large or small fluxes, NaN values in any field, or values that are zero where they shouldn&#39;t be.</p><h3 id="Plotting-ClimaCore-fields"><a class="docs-heading-anchor" href="#Plotting-ClimaCore-fields">Plotting ClimaCore fields</a><a id="Plotting-ClimaCore-fields-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-ClimaCore-fields" title="Permalink"></a></h3><p>The built-in <code>Plotting.debug</code> function produces a grid of heatmaps of all coupler and component model fields, and is the easiest first step:</p><pre><code class="language-julia hljs"># Plot all coupler fields and component model fields to a directory
Plotting.debug(cs, &quot;debug_output&quot;)
# Produces: debug_output/debug_coupler.png, debug_output/debug_&lt;ModelName&gt;.png, etc.</code></pre><p>You can also plot individual ClimaCore fields with ClimaCoreMakie directly:</p><pre><code class="language-julia hljs">using ClimaCoreMakie, CairoMakie, Makie

field = cs.fields.T_sfc  # any ClimaCore surface field

fig = Figure()
ax = Axis(fig[1, 1], title = &quot;T_sfc $(extrema(field))&quot;)
hm = fieldheatmap!(ax, field)
Colorbar(fig[:, end+1], hm)
Makie.save(&quot;T_sfc.png&quot;, fig)</code></pre><p>For 3D fields (e.g. from the atmosphere), extract a level first:</p><pre><code class="language-julia hljs">import ClimaCore as CC

field_3d = cs.model_sims.atmos.integrator.u.c.ρe_tot  # example 3D field
field_sfc = CC.Fields.level(field_3d, 1)               # bottom level

fig = Figure()
ax = Axis(fig[1, 1], title = &quot;ρe_tot (level 1)&quot;)
hm = fieldheatmap!(ax, field_sfc)
Colorbar(fig[:, end+1], hm)
save(&quot;rhoe_sfc.png&quot;, fig)</code></pre><h3 id="Plotting-Oceananigans-fields"><a class="docs-heading-anchor" href="#Plotting-Oceananigans-fields">Plotting Oceananigans fields</a><a id="Plotting-Oceananigans-fields-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Oceananigans-fields" title="Permalink"></a></h3><p>When running a CMIP simulation with <code>OceananigansSimulation</code>, use <code>CairoMakie.heatmap!</code> on a horizontal slice of the Oceananigans field. Note that this applies to <code>ClimaSeaIceSimulation</code> fields too, since it uses Oceananigans.jl under the hood.</p><p>For a 2D field we just access the underlying array:</p><pre><code class="language-julia hljs">using CairoMakie, Makie
import Oceananigans as OC

ice = cs.model_sims.ice_sim.ice
ice_T = ice.model.ice_thermodynamics.top_surface_temperature # Oceananigans field
ice_T_array = OC.interior(ice_T, :, :, 1) # 2D underlying array

fig = Figure()
ax = Axis(fig[1, 1], title = &quot;Ice surface T&quot;)
hm = heatmap!(ax, ice_T_array)
Colorbar(fig[:, end+1], hm)
Makie.save(&quot;ice_T_sfc.png&quot;, fig)</code></pre><p>For a 3D field we need to index into the top level of the grid:</p><pre><code class="language-julia hljs">using CairoMakie, Makie
import Oceananigans as OC

ocean = cs.model_sims.ocean_sim.ocean
ocean_T_3d = ocean.model.tracers.T
# Index into the surface (top) level of the 3D field
ocean_T_surface = OC.interior(ocean_T_3d, :, :, ocean.model.grid.Nz)

fig = Figure()
ax = Axis(fig[1, 1], title = &quot;Ocean surface T&quot;)
hm = heatmap!(ax, ocean_T_surface)
Colorbar(fig[:, end+1], hm)
Makie.save(&quot;ocean_T_sfc.png&quot;, fig)</code></pre><p>For <code>AbstractOperation</code> fields (derived quantities), compute them first then index as appropriate for the field&#39;s domain:</p><pre><code class="language-julia hljs">field_3d = OC.Field(some_operation)
OC.compute!(field_3d)
CairoMakie.heatmap!(ax, view(field_3d, :, :, derived.grid.Nz))</code></pre><p>The <code>Plotting.debug</code> function handles both field types automatically when the <code>ClimaCouplerCMIPMakieExt</code> extension is loaded.</p><h2 id="Software-errors"><a class="docs-heading-anchor" href="#Software-errors">Software errors</a><a id="Software-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Software-errors" title="Permalink"></a></h2><h3 id="Identifying-which-method-is-being-dispatched"><a class="docs-heading-anchor" href="#Identifying-which-method-is-being-dispatched">Identifying which method is being dispatched</a><a id="Identifying-which-method-is-being-dispatched-1"></a><a class="docs-heading-anchor-permalink" href="#Identifying-which-method-is-being-dispatched" title="Permalink"></a></h3><p>A common source of subtle bugs is a function being called with an unexpected type, causing Julia to dispatch to the wrong method. If you suspect this is the case, use <code>@which</code> to confirm which method will be called:</p><pre><code class="language-julia hljs"># See exactly which method Julia will call for these argument types
@which FieldExchanger.update_sim!(sim, coupler_fields, area_fraction)

# List all defined methods of a function
methods(FieldExchanger.update_sim!)

# List all methods applicable to a specific type
import InteractiveUtils: methodswith
methodswith(typeof(sim), FieldExchanger.update_sim!)</code></pre><p>This is particularly useful when adding a new component model: if a required interface function (e.g. <code>Interfacer.get_field</code>, <code>Interfacer.update_field!</code>) is not extended for your new type, Julia will silently dispatch to a fallback method rather than erroring. <code>@which</code> will reveal this immediately.</p><h3 id="Checking-return-values-and-field-updates"><a class="docs-heading-anchor" href="#Checking-return-values-and-field-updates">Checking return values and field updates</a><a id="Checking-return-values-and-field-updates-1"></a><a class="docs-heading-anchor-permalink" href="#Checking-return-values-and-field-updates" title="Permalink"></a></h3><p>If a field is unexpectedly zero or unchanged after a coupling step, trace back through the call chain by inserting <code>@info</code> statements or using the Julia debugger:</p><pre><code class="language-julia hljs">import Debugger
Debugger.@enter FieldExchanger.exchange!(cs)</code></pre><p>You can also use <code>@show</code> to quickly print intermediate values without a full debugger session:</p><pre><code class="language-julia hljs">@show extrema(cs.fields.T_sfc)
@show nameof(typeof(cs.model_sims.ocean_sim))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../contributing/">« Contributing</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 27 February 2026 23:06">Friday 27 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
